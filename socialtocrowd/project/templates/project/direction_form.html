{% extends "base.html" %}
{% load i18n %}
{% load bootstrap %}

{% block extrabody %}

<script type="text/javascript">

function SelectPlaceMap( args )
{
	// arguments
	args = args || {};
	args.marker_image = args.marker_image || '{{ STATIC_URL }}media/mapmarker.png';
	args.default_position = args.default_position || [637125.42195, 8172199.19090669];
	args.map_div_id = args.map_div_id || 'id_pos_map';

	this.markerImage= args.marker_image;
	this.iconGeometry = new ol.geom.Point(args.default_position);
	this.iconFeature = new ol.Feature({
		geometry: this.iconGeometry
	});
	this.iconStyle = new ol.style.Style({
		image: new ol.style.Icon(/** @type {olx.style.IconOptions} */ ({
			anchor: [0.5, 46],
			anchorXUnits: 'fraction',
			anchorYUnits: 'pixels',
			opacity: 0.75,
			src: this.markerImage
		}))
	});
	this.iconFeature.setStyle(this.iconStyle);
	this.vectorSource = new ol.source.Vector({
		features: [this.iconFeature]
	});
	this.vectorLayer = new ol.layer.Vector({
		source: this.vectorSource
	});
	this.osmLayer = new ol.layer.Tile({
		source: new ol.source.OSM()
	});
	this.mapView = new ol.View({
		center: [0, 0],
		zoom: 8
	});

	this.map = new ol.Map({
		layers: [this.osmLayer, this.vectorLayer],
		target: 'id_pos_map',
		controls: ol.control.defaults({
			attributionOptions: /** @type {olx.control.AttributionOptions} */ ({
				collapsible: false
			})
		}),
		view: this.mapView
	});

	var that = this;
	// that?
	this.setMarkerPlaceLatLon = function( lat, lon ) {
		var normalized_coords = ol.proj.transform([lat, lng], 'EPSG:4326', 'EPSG:3857');
		that.iconGeometry.setCoordinates(normalized_coords);
		that.mapView.setCenter(normalized_coords);
	};

	// that?
	this.map.on('singleclick', function(evt) {
		that.iconGeometry.setCoordinates(evt.coordinate);
	});
}

var selectMap = new SelectPlaceMap({
	marker_image: '{{ STATIC_URL }}media/mapmarker.png',
	default_position: [637125.42195, 8172199.19090669],
	map_div_id: 'id_pos_map'
});

if ("{{ direction }}") { // Paint point and center
	var lat = parseFloat("{{ direction.pos.0 }}");
	var lng = parseFloat("{{ direction.pos.1 }}");
	selectMap.setMarkerPlaceLatLon( lat, lon );
}


</script>


{% endblock %}
{% block content %}

    <form action="" method="post">
        {% csrf_token %}
        {{ form|bootstrap }}
        {% if edit %}
            <input type="submit" class="btn btn-block btn-success" value="{% trans "Update" %}" />
        {% else %}
            <input type="submit" class="btn btn-block btn-success" value="{% trans "Create" %}" />
        {% endif %}
    </form>
    <div id="id_pos_map">
	</div>

{% endblock %}

